<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>BHA Animated & Clickable</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
</head>
<body style="margin:0">
  <div id="bhaInteractive" style="width: 100%; height: 500px;"></div>

  <script>
    const baseY = 180;
    const baseX = 50;
    const height = 60;
    let currentX = baseX;
    let angle = 0;

    const components = [
      {
        name: 'Drillpipe',
        width: 80,
        color: '#A0A0A0',
        description: 'Transmits torque and fluid.',
        url: 'https://example.com/drillpipe'
      },
      {
        name: 'Crossover Sub',
        width: 60,
        color: '#8888CC',
        description: 'Connects different tool joints.',
        url: 'https://example.com/crossover'
      },
      {
        name: 'Drill Collar',
        width: 100,
        color: '#FFD700',
        description: 'Adds weight on bit and stiffness.',
        url: 'https://example.com/drillcollar'
      },
      {
        name: 'Stabilizer',
        width: 80,
        description: 'Centralizes BHA.',
        url: 'https://example.com/stabilizer',
        render: (x, y, w, h) => ({
          type: 'path',
          shape: {
            pathData: `
              M${x + w/2 - 15},${y}
              L${x + w/2 + 15},${y}
              L${x + w},${y + h/2}
              L${x + w/2 + 15},${y + h}
              L${x + w/2 - 15},${y + h}
              L${x},${y + h/2}
              Z
            `
          },
          style: { fill: '#32CD32', stroke: '#000' }
        })
      },
      {
        name: 'Reamer',
        width: 80,
        description: 'Enlarges/conditions borehole.',
        url: 'https://example.com/reamer',
        render: (x, y, w, h) => ({
          type: 'path',
          shape: {
            pathData: `
              M${x},${y + h}
              L${x + w/4},${y}
              L${x + 3*w/4},${y}
              L${x + w},${y + h}
              Z
            `
          },
          style: { fill: '#FF8C00', stroke: '#000' }
        })
      },
      {
        name: 'Bit',
        width: 90,
        description: 'Breaks rock, drills formation.',
        url: 'https://example.com/bit',
        isBit: true // flag for rotation
      }
    ];

    const chart = echarts.init(document.getElementById('bhaInteractive'));

    function generateRenderItems(rotation = 0) {
      currentX = baseX;
      const renderItems = [];

      for (const comp of components) {
        const x = currentX;
        const y = baseY;
        const w = comp.width;

        let shapeItem;
        if (comp.isBit) {
          // Bit with rotation
          shapeItem = {
            type: 'group',
            rotation: (rotation * Math.PI) / 180,
            origin: [x + w / 2, y + height / 2],
            children: [
              {
                type: 'rect',
                shape: { x, y, width: w, height: height - 10 },
                style: { fill: '#DC143C', stroke: '#000' }
              },
              {
                type: 'path',
                shape: {
                  pathData: `
                    M${x},${y + height - 10}
                    L${x + w * 0.25},${y + height}
                    L${x + w * 0.5},${y + height - 5}
                    L${x + w * 0.75},${y + height}
                    L${x + w},${y + height - 10}
                    Z
                  `
                },
                style: { fill: '#DC143C', stroke: '#000' }
              }
            ]
          };
        } else if (comp.render) {
          shapeItem = comp.render(x, y, w, height);
        } else {
          shapeItem = {
            type: 'rect',
            shape: { x, y, width: w, height: height },
            style: { fill: comp.color || '#ccc', stroke: '#000' }
          };
        }

        renderItems.push({
          type: 'group',
          children: [
            {
              ...shapeItem,
              info: {
                name: comp.name,
                description: comp.description,
                url: comp.url
              }
            },
            {
              type: 'text',
              style: {
                text: comp.name,
                x: x + w / 2,
                y: y + height / 2,
                textAlign: 'center',
                textVerticalAlign: 'middle',
                font: 'bold 13px sans-serif',
                fill: '#000'
              }
            }
          ]
        });

        currentX += w + 20;
      }

      return renderItems;
    }

    chart.setOption({
      title: {
        text: 'Bottom Hole Assembly (Animated + Clickable)',
        left: 'center'
      },
      tooltip: {
        trigger: 'item',
        formatter: function (params) {
          const info = params?.data?.info;
          return info ? `<b>${info.name}</b><br/>${info.description}` : '';
        }
      },
      xAxis: { show: false, min: 0, max: 1000 },
      yAxis: { show: false, min: 0, max: 500 },
      series: [{
        type: 'custom',
        renderItem: function (params, api) {
          return {
            type: 'group',
            children: generateRenderItems(angle)
          };
        },
        data: generateRenderItems()
      }]
    });

    // ðŸ” Bit Rotation Animation
    setInterval(() => {
      angle = (angle + 5) % 360;
      chart.setOption({
        series: [{
          type: 'custom',
          renderItem: function (params, api) {
            return {
              type: 'group',
              children: generateRenderItems(angle)
            };
          },
          data: generateRenderItems()
        }]
      });
    }, 100);

    // ðŸ§  Clickable Parts
    chart.getZr().on('click', function (event) {
      const pointInPixel = [event.offsetX, event.offsetY];
      const pointInGrid = chart.convertFromPixel({ seriesIndex: 0 }, pointInPixel);

      const data = generateRenderItems(angle);
      for (const item of data) {
        const info = item.children[0]?.info;
        if (info && info.url) {
          const shape = item.children[0].shape;
          // Rough hit area (for simplification)
          if (
            event.offsetX >= shape.x &&
            event.offsetX <= shape.x + shape.width &&
            event.offsetY >= shape.y &&
            event.offsetY <= shape.y + shape.height
          ) {
            window.open(info.url, '_blank');
            break;
          }
        }
      }
    });
  </script>
</body>
</html>
